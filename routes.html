<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Airline Routes Map Demo</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      :root {
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      }
      body { margin: 0; padding: 0; background: #020617; color: #e2e8f0; }
      #map { position: absolute; top: 56px; bottom: 0; width: 100%; }
      .mapboxgl-ctrl-logo, .mapboxgl-ctrl-attrib { display: none !important; }

      /* Navigation header */
      .nav-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 56px;
        background: rgba(2, 6, 23, 0.92);
        border-bottom: 1px solid rgba(148, 163, 184, 0.15);
        backdrop-filter: blur(12px);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1.25rem;
        z-index: 100;
      }
      .nav-brand {
        font-size: 1.1rem;
        font-weight: 600;
        color: #f8fafc;
        letter-spacing: -0.01em;
      }
      .nav-links {
        display: flex;
        gap: 0.5rem;
      }
      .nav-links a {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        text-decoration: none;
        color: #94a3b8;
        transition: background 0.15s, color 0.15s;
      }
      .nav-links a:hover {
        background: rgba(148, 163, 184, 0.1);
        color: #e2e8f0;
      }
      .nav-links a.active {
        background: rgba(56, 189, 248, 0.15);
        color: #38bdf8;
      }

      /* Mobile adjustments */
      @media (max-width: 480px) {
        .nav-header {
          padding: 0 0.75rem;
        }
        .nav-brand {
          font-size: 0.95rem;
        }
        .nav-links a {
          padding: 0.45rem 0.7rem;
          font-size: 0.8rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="nav-header">
      <div class="nav-brand">TalkTravel Maps</div>
      <nav class="nav-links">
        <a href="jigsaw.html">Jigsaw</a>
        <a href="routes.html" class="active">Routes</a>
        <a href="discover.html">Discover</a>
      </nav>
    </header>
    <div id="map"></div>

    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
    <script>
      // Mapbox access token
      mapboxgl.accessToken = 'pk.eyJ1IjoiZGttaWNoYWVscyIsImEiOiJjbWlnczV6bnQwYjlxM2Nvb2U2YjNseWxoIn0.bG5oBDdzT3coIAlUDk8fxA';

      // Adjust zoom for mobile
      const isMobile = window.innerWidth <= 480;

      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v11',
        center: [-40, 25],
        zoom: isMobile ? 0.8 : 1.8,
      });

      // City data
      const places = {
        SFO: { name: 'San Francisco', lon: -122.379, lat: 37.621 },
        JFK: { name: 'New York', lon: -73.778, lat: 40.641 },
        LHR: { name: 'London', lon: -0.4543, lat: 51.47 },
        NRT: { name: 'Tokyo', lon: 140.3929, lat: 35.7767 },
        GRU: { name: 'SÃ£o Paulo', lon: -46.4731, lat: -23.4356 },
      };

      // Route definitions
      const routes = [
        { from: 'SFO', to: 'JFK', degree: 1 },
        { from: 'SFO', to: 'LHR', degree: 1 },
        { from: 'SFO', to: 'NRT', degree: 1 },
        { from: 'JFK', to: 'GRU', degree: 2 },
        { from: 'LHR', to: 'NRT', degree: 2 },
      ];

      // Build GeoJSON for routes using Turf.js great circles
      function buildRoutesGeoJSON() {
        const features = routes.map(route => {
          const start = [places[route.from].lon, places[route.from].lat];
          const end = [places[route.to].lon, places[route.to].lat];
          const arc = turf.greatCircle(start, end, {
            npoints: 100,
            properties: {
              from: route.from,
              to: route.to,
              degree: route.degree,
            },
          });
          return arc;
        });

        return {
          type: 'FeatureCollection',
          features,
        };
      }

      // Build GeoJSON for city points
      function buildPlacesGeoJSON() {
        const features = Object.entries(places).map(([code, data]) => ({
          type: 'Feature',
          geometry: {
            type: 'Point',
            coordinates: [data.lon, data.lat],
          },
          properties: {
            code,
            name: data.name,
          },
        }));

        return {
          type: 'FeatureCollection',
          features,
        };
      }

      map.on('load', () => {
        // Add routes source and layer
        map.addSource('routes', {
          type: 'geojson',
          data: buildRoutesGeoJSON(),
        });

        map.addLayer({
          id: 'route-lines',
          type: 'line',
          source: 'routes',
          paint: {
            'line-color': [
              'case',
              ['==', ['get', 'degree'], 1],
              '#38bdf8',  // first-degree: bright sky blue
              '#64748b',  // second-degree: muted slate
            ],
            'line-width': [
              'interpolate',
              ['linear'],
              ['zoom'],
              1, ['case', ['==', ['get', 'degree'], 1], 2.5, 1.5],
              4, ['case', ['==', ['get', 'degree'], 1], 4.0, 2.5],
            ],
            'line-opacity': 0.9,
          },
          layout: {
            'line-cap': 'round',
            'line-join': 'round',
          },
        });

        // Add places source and layer
        map.addSource('places', {
          type: 'geojson',
          data: buildPlacesGeoJSON(),
        });

        map.addLayer({
          id: 'place-points',
          type: 'circle',
          source: 'places',
          paint: {
            'circle-radius': 6,
            'circle-color': '#f97316',  // orange
            'circle-stroke-color': '#fdba74',
            'circle-stroke-width': 2,
            'circle-opacity': 1,
          },
        });

        // Add city labels
        map.addLayer({
          id: 'place-labels',
          type: 'symbol',
          source: 'places',
          layout: {
            'text-field': ['get', 'code'],
            'text-font': ['DIN Pro Medium', 'Arial Unicode MS Regular'],
            'text-size': 12,
            'text-offset': [0, 1.5],
            'text-anchor': 'top',
          },
          paint: {
            'text-color': '#e2e8f0',
            'text-halo-color': '#020617',
            'text-halo-width': 1,
          },
        });
      });
    </script>
  </body>
</html>
